## 原理和设计

比特币网络是一个分布式的点对点网络，网络中的矿工通过“挖矿”来完成记账过程，维护网络的正常运行。

用户可以将比特币的交易记录写到比特币网络中，等网络确认后即可认为交易完成。

一个交易将某些未经使用的交易（UTXO）的输出（作为本次交易的输入）将一笔钱（作为本次交易的输出）转移到另外一些账户地址。这笔钱必须是所引用交易的输出，并且输入必须不能小于输出。

交易的最小单位是“聪”，即 $$10^{-8}$$ 比特币。

下图展示了一些简单的示例交易。更一般情况下，交易的输入输出可以为多方。

| 交易 | 目的 | 输入 | 输出 | 差额 |
| :--- | :--- | :--- | :--- | :--- |
| T0 | A 转给 B | 别人给 A 的交易的输出 | B 账户增加金额 | 输入减输出，为交易服务费 |
| T1 | B 转给 C | T0 的输出 | C 账户增加金额 | 输入减输出，为交易服务费 |
| ... | X 转给 Y | 别人给 X 的交易的输出 | 接收方地址增加资金 | 输入减输出，为交易服务费 |

### 交易

一条交易将包括如下内容：

* 付款人地址：合法的地址，公钥经过 SHA256 和 RIPEMD160 两次 hash，得到 160 位 hash 串；
* 付款人对交易的签字确认：确保交易内容不被篡改；
* 付款人资金的来源交易 ID：从哪个交易的输出作为本次交易的输入；
* 交易的金额：多少钱，跟输入的差额为交易的服务费；
* 收款人地址：合法的地址；
* 收款人的公钥：收款人的公钥；
* 时间戳：交易何时能生效。

### 区块

一个区块将包括如下内容：

4 字节的区块大小信息；

80 字节的区块头信息：

* 版本号：4 字节；
* 上一个区块头的 SHA256 hash 值：链接到一个合法的块上，32 字节；
* 包含的所有验证过的交易的 Merkle 树根的哈希值，32 字节；
* 时间戳：4 字节；
* 难度指标：4 字节；
* Nonce：4 字节，PoW 问题的答案；

交易个数计数器；

所有交易的内容。

### 账户

比特币账户采用了非对称的加密算法，用户自己保留私钥，对他发出的交易进行签名确认，并公开公钥。

比特币的账户地址其实就是用户公钥经过一系列 hash 及编码运算后生成的字符串。

### 如何避免作恶

基于经济博弈原理。在一个开放的网络中，无法通过技术手段保证每个人都是合作的。但可以通过经济博弈来让合作者得到利益，让非合作者遭受损失和风险。

实际上，博弈论早已被广泛应用到众多领域。

一个经典的例子是两个人来分一个蛋糕，如果都想拿到较大的一块，在没有第三方的前提下，该怎么指定规则才公平？

最简单的一个方案是负责切蛋糕的人后选。

_注：如果推广到 N 个人呢？_

比特币网络需要所有试图参与者（矿工）都首先要付出挖矿的代价，进行算力消耗，越想拿到新区块的决定权，意味着抵押的算力越多。一旦失败，这些算力都会被没收掉，成为沉没成本。当网络中存在众多参与者时，个体试图拿到新区块决定权要付出的算力成本是巨大的，意味着进行一次作恶付出的代价已经超过可能带来的好处。

### 负反馈调节

比特币网络在设计上，很好的体现了负反馈的控制论基本原理。

比特币网络中矿工越多，系统就越稳定，比特币价值就越高，但挖到矿的概率会降低。

反之，网络中矿工减少，会让系统更容易导致被攻击，比特币价值越低，但挖到矿的概率会提高。

因此，比特币的价格理论上应该稳定在一个合适的值（网络稳定性也会稳定在相应的值），这个价格乘以挖到矿的概率，恰好达到矿工的收益预期。

从长远角度看，硬件成本是下降的，但每个区块的比特币奖励每隔 4 年减半，最终将在 2140 年达到 2100 万枚，之后将完全依靠交易的服务费来鼓励矿工对网络的维护。

